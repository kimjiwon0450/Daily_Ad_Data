name: Facebook Ads ETL Daily Run

on:
  schedule:
    # 매일 한국 시간 오전 7시 13분 (UTC 22:13)
    - cron: '13 22 * * *'

  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest

    steps:
    # 1. 코드 가져오기 (main.py 등)
    - name: Checkout repository
      uses: actions/checkout@v3

    # 2. 파이썬 설치
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    # 3. 라이브러리 설치 (중복된 줄 정리함)
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install facebook_business pandas pandas-gbq google-auth google-cloud-bigquery gspread oauth2client

    # 4. ★ [중요] 비밀 금고에서 꺼내서 파일 만들기 ★
    - name: Create Secret Files
      run: |
        # CONFIG_JSON 시크릿을 꺼내서 config.json 파일을 만듦
        echo '${{ secrets.CONFIG_JSON }}' > config.json
        
        # GOOGLE_KEY_JSON 시크릿을 꺼내서 service_key.json 파일을 만듦
        echo '${{ secrets.GOOGLE_KEY_JSON }}' > service_key.json

    # 5. 프로그램 실행
    - name: Run ETL Script
      run: python "메타_마케팅데이터_가져오기.py"
